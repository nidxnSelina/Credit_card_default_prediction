---
title: "Credit card default prediction"
output: html_notebook
---

# Credit Card Default Prediction

Project: Predict whether a customer will default on their credit card
Feb.13th 2024
Selina Wang, Eileen Hu, Alex Huang, Jeffrey Wu, Ziao Xiong

1. Introduction

1.1 Problem description and Objective
(literature review qfehwgrjbkfndlwjaofihgdui)

The goal of this project is to predict whether or not a customer will default on a credit card payment due next month, given a collection of client records in Taiwan, including customer demographics, history of payment, and the case of default payment.

1.2 Data description
The dataset is acquired from Kaggle: https://www.kaggle.com/datasets/uciml/default-of-credit-card-clients-dataset?resource=download

This dataset contains information on default payments, demographic factors, history of repayment status, and bill statements of credit card clients in Taiwan from April 2005 to September 2005. It contains records of 30000 customers with 25 features. Below is a description of them:

- ID: ID of each client
- LIMIT_BAL: Amount of given credit in NT dollars (includes individual and family/supplementary credit)
- SEX: Gender (1=male, 2=female)
- EDUCATION: (1=graduate school, 2=university, 3=high school, 4=others, 5=unknown, 6=unknown)
- MARRIAGE: Marital status (1=married, 2=single, 3=others)
- AGE: Age in years
Scale of PAY_0, PAY_2, PAY_3, PAY_4, PAY_5, and PAY_6: -2 = no consumption, -1 = paid in full, 0 = use of revolving credit (paid minimum only), 1 = payment delay for one month, 2 = payment delay for two months, â€¦, 8 = payment delay for eight months, 9 = payment delay for nine months and above
- PAY_0: Repayment status in September, 2005 
- PAY_2: Repayment status in August, 2005  
- PAY_3: Repayment status in July, 2005  
- PAY_4: Repayment status in June, 2005  
- PAY_5: Repayment status in May, 2005  
- PAY_6: Repayment status in April, 2005  
All amount of bill statement are shown in New Taiwan dollar (NT dollar)
- BILL_AMT1: Amount of bill statement in September, 2005  
- BILL_AMT2: Amount of bill statement in August, 2005  
- BILL_AMT3: Amount of bill statement in July, 2005  
- BILL_AMT4: Amount of bill statement in June, 2005  
- BILL_AMT5: Amount of bill statement in May, 2005  
- BILL_AMT6: Amount of bill statement in April, 2005  
- PAY_AMT1: Amount of previous payment in September, 2005  
- PAY_AMT2: Amount of previous payment in August, 2005  
- PAY_AMT3: Amount of previous payment in July, 2005  
- PAY_AMT4: Amount of previous payment in June, 2005  
- PAY_AMT5: Amount of previous payment in May, 2005  
- PAY_AMT6: Amount of previous payment in April, 2005  
- default.payment.next.month: Default payment (0 = no, 1 = yes)


2. Exploratory Data Analysis

```{r}
ccard = read.csv("/Users/selina.wang/Desktop/Credit_card_default_prediction/UCI_Credit_Card.csv")
attach(ccard)
str(ccard)
```

Explore the numerical variables: LIMIT_BAL and AGE
```{r}
par(mfrow=c(1,2))

boxplot(LIMIT_BAL~default.payment.next.month, xlab = "Defaulter")
boxplot(AGE~default.payment.next.month, xlab = "Defaulter")

par(mfrow=c(1,1))
```

Explore the categorical variables: SEX, EDUCATION, MARRIAGE
```{r}
library(ggplot2)
library(dplyr)

ccard_cat <- ccard[c('SEX', 'EDUCATION', 'MARRIAGE')]
ccard_cat$Defaulter <- ccard$default.payment.next.month

# Replace values with labels
ccard_cat$SEX <- factor(ccard_cat$SEX, labels = c("Male", "Female"))
ccard_cat$EDUCATION <- factor(ccard_cat$EDUCATION, levels = c(1, 2, 3, 4), labels = c("Graduate school", "University", "High school", "Others"))
ccard_cat$MARRIAGE <- factor(ccard_cat$MARRIAGE, levels = c(1, 2, 3), labels = c("Married", "Single", "Others"))

# Plot countplots
for (col in categorical_features) {
  count_plot <- ggplot(ccard_cat, aes(x = !!sym(col), fill = factor(Defaulter))) +
    geom_bar(position = "dodge") +
    labs(title = paste("Countplot of", col),
         x = col,
         y = "Count",
         fill = "Defaulter") +
    theme_minimal()
  
  plot(count_plot)
}
```

Explore the history of repayment status: PAY_0, PAY_2, PAY_3, PAY_4, PAY_5, and PAY_6
```{r}
PAY = c("PAY_0", "PAY_2", "PAY_3", "PAY_4", "PAY_5", "PAY_6")

for (i in PAY) {
  count_plot <- ggplot(ccard, aes(x = !!sym(i), fill = factor(default.payment.next.month))) +
    geom_bar(position = "dodge") +
    labs(title = paste("Countplot of", i),
         x = i,
         y = "Count",
         fill = "Defaulter") +
    theme_minimal()
  
  plot(count_plot)
}
```

Explore the amount of bill statement and previous payment for the past 6 months: 
```{r}
BILL_AMT = c("BILL_AMT1", "BILL_AMT2", "BILL_AMT3", "BILL_AMT4", "BILL_AMT5", "BILL_AMT6")
pairs(ccard[BILL_AMT])

PAY_AMT = c("PAY_AMT1", "PAY_AMT2", "PAY_AMT3", "PAY_AMT4", "PAY_AMT5", "PAY_AMT6")
pairs(ccard[PAY_AMT])
```

Explore the target variable default.payment.next.month
```{r}
freq <- table(default.payment.next.month)
barplot(freq, col = "steelblue", main = "Target Variable Distribution", ylim=c(0,30000), xlab = "Defaulter", ylab = "Frequency")
```

3. Feature Engineering

Rename the variables
```{r}
column_names <- list(
  PAY_0 = "PAY_SEPT", PAY_2 = "PAY_AUG", PAY_3 = "PAY_JUL", PAY_4 = "PAY_JUN", PAY_5 = "PAY_MAY", PAY_6 = "PAY_APR", BILL_AMT1 = "BILL_AMT_SEPT", BILL_AMT2 = "BILL_AMT_AUG", BILL_AMT3 = "BILL_AMT_JUL", BILL_AMT4 = "BILL_AMT_JUN", BILL_AMT5 = "BILL_AMT_MAY", BILL_AMT6 = "BILL_AMT_APR", PAY_AMT1 = "PAY_AMT_SEPT", PAY_AMT2 = "PAY_AMT_AUG", PAY_AMT3 = "PAY_AMT_JUL", PAY_AMT4 = "PAY_AMT_JUN", PAY_AMT5 = "PAY_AMT_MAY", PAY_AMT6 = "PAY_AMT_APR",default.payment.next.month="IsDefaulter"
)

for (old_name in names(column_names)) {
  new_name <- column_names[[old_name]]
  names(my_data)[names(my_data) == old_name] <- new_name
}

names(my_data)
```

Encoding categorical variables using one-hot encoding
```{r}

```

Handle missing data
```{r}
my_data = na.omit(my_data)
dim(my_data)
```

Handle outliers
```{r}
##Use 3 sigma method to remove outliers

#Only remove outliers in numerical variables
numeric_cols <- sapply(my_data, is.numeric)

valid_rows <- rep(TRUE, nrow(my_data))

for (i in which(numeric_cols)) {  
  print(i)
  mean_col <- mean(my_data[, i])  
  sd_col <- sd(my_data[, i])    
  lower_bound <- mean_col - 3 * sd_col
  upper_bound <- mean_col + 3 * sd_col
  # update valid_rows based on 3 sigma bound
  valid_rows <- valid_rows & (my_data[, i] >= lower_bound & my_data[, i] <= upper_bound)
}

    
data = my_data[valid_rows,]

dim(data)

```

Create new variables
```{r}

```

Perform clustering
```{r}

```

The following models are aimed at predicting the IsDefaulter variable using the rest of the variables in the dataset as predictors.


4. Predictive Analysis

4.1 Logistic Regression
4.2. LDA
4.3. QDA
4.4. Classification Tree
4.5. Bagging
4.6. Random Forest
4.7. Boosted Trees
4.8. Neural Network 

5. Model Evaluations

6. Conclusion
